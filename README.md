# 🌿 Vegetable Pricing & Replenishment Optimization Model

本项目致力于构建一套以数据驱动的【蔬菜定价与补货优化系统】，针对超市多品类蔬菜商品的销售数据，结合**统计分析、时间序列预测与智能优化算法**，实现精准预测与利润最大化。

---

## 🎯 项目背景与研究目标

在生鲜商超中，一般蔬菜类商品的保鲜期都比较短，且品相随销售时间的增加而变差，大部分品种如当日未售出，隔日就无法再售。因此，商超通常会根据各商品的历史销售和需求情况每天进行补货。

由于商超销售的蔬菜品种众多、产地不尽相同，而蔬菜的进货交易时间通常在凌晨 3:00-4:00，为此商家须在不确切知道具体单品和进货价格的情况下，做出当日各蔬菜品类的补货决策。蔬菜的定价一般采用"成本加成定价"方法，商超对运损和品相变差的商品通常进行打折销售。

可靠的市场需求分析，对补货决策和定价决策尤为重要。从需求侧来看，蔬菜类商品的销售量与时间往往存在一定的关联关系；从供给侧来看，蔬菜的供应品种在 4 月至 10月较为丰富，商超销售空间的限制使得合理的销售组合变得极为重要。

本项目基于三个历史销售数据文件，设计并实现一整套“预测 + 优化”流程，依次解决以下关键问题：

- 🥬 **问题一**：蔬菜类商品不同品类或不同单品之间可能存在一定的关联关系，分析蔬菜各品类及单品销售量的分布规律及相互关系
- 🔮 **问题二**：考虑商超以品类为单位做补货计划，请分析各蔬菜品类的销售总量与成本加成定价的关系，并给出各蔬菜品类未来一周(2023 年 7 月 1-7 日)的日补货总量和定价策略，使得商超收益最大
- 🧠 **问题三**：因蔬菜类商品的销售空间有限，商超希望进一步制定单品的补货计划，要求可售单品总数控制在 27-33 个，且各单品订购量满足最小陈列量 2.5 千克的要求。根据 2023年 6 月 24-30 日的可售品种，给出 7 月 1 日的单品补货量和定价策略，在尽量满足市场对各品类蔬菜商品需求的前提下，使得商超收益最大。


---

## 📦 数据集说明

我们使用了四个真实交易维度的 Excel 数据文件（“附件1~4”）：

| 数据来源 | 文件名 | 核心字段 | 数据量级 |
|----------|--------|----------|----------|
| 商品属性数据 | 附件1.xlsx | 单品编码、单品名称、分类编码、分类名称  | 250个单品 |
| 销售定价记录 | 附件2.xlsx | 销售日期、扫码销售时间、单品编码、销量（千克）、销售单价（元/千克）、销售类型，是否打折 | 多日期 × 多商品 |
| 批发价格记录 | 附件3.xlsx | 销售日期、单品编码、批发价格 | 超过 1 年批发记录 |
| 损耗率 | 附件3.xlsx | 单品编码、单品名称、损耗率 | 250个单品 |

我们通过统一主键（单品编码 + 销售日期）进行三表合并，形成了包含价格、销量、分类属性的完整交易数据表，在本地存储为merged_final文件。

## 🧾 数据格式示例

合并后的 `merged_final` 数据表整合了商品属性、销售记录、批发价格与损耗率，形成可用于后续分析与建模的核心表格。

以下为该数据表的前几行示意（以“泡泡椒（精品）”为例）：

| 销售日期 | 扫码销售时间 | 单品编码 | 销量(千克) | 销售单价(元/千克) | 销售类型 | 是否打折 | 单品名称 | 分类名称 | 批发价格(元/千克) | 销售总量 |
|-----------|----------------|-----------|--------------|--------------------|-----------|------------|------------|-----------|----------------------|------------|
| 2020-07-01 | 09:15:07.924   | 102900005117056 | 0.396 | 7.6 | 销售 | 否 | 泡泡椒（精品） | 辣椒类 | 4.32 | 3.0096 |
| 2020-07-01 | 09:17:33.905   | 102900005117056 | 0.409 | 7.6 | 销售 | 否 | 泡泡椒（精品） | 辣椒类 | 4.32 | 3.1084 |
| 2020-07-01 | 09:21:55.556   | 102900005117056 | 0.277 | 7.6 | 销售 | 否 | 泡泡椒（精品） | 辣椒类 | 4.32 | 2.1052 |
| 2020-07-01 | 09:22:01.274   | 102900005117056 | 0.132 | 7.6 | 销售 | 否 | 泡泡椒（精品） | 辣椒类 | 4.32 | 1.0032 |
| 2020-07-01 | 09:41:09.342   | 102900005117056 | 0.198 | 7.6 | 销售 | 否 | 泡泡椒（精品） | 辣椒类 | 4.32 | 1.5048 |

> 注：销售总量 = 销量 × 销售单价（单位为元）





---

## 🧰 项目环境

- Python >= 3.10
- 推荐使用 Conda 或 venv 虚拟环境管理
- 所需依赖请见 `requirements.txt`，核心库包括：
  - `pandas`, `numpy`, `matplotlib`, `seaborn`
  - `scikit-learn`, `statsmodels`, `prophet`
  - `cvxpy`, `deap`（用于优化）

---

## 📈 数据处理与建模方法

### 🧹 数据清洗与预处理

- 销量归一化、缺失数据前向填充、异常值处理
- 分类层级构建与单品映射
- 滑窗构建时间序列结构

### 🔍 探索性分析

- 銷量与价格的相关性热力图（皮尔逊）
- Top-N 分类与单品销售趋势可视化
- 类别间销售量堆叠图、增长趋势折线图

### ⏳ 时间序列建模

- **ARIMA**：用于短期销量预测
- **Prophet**：考虑节假日与周效应的长期销量趋势预测

### 🧮 优化建模方法

| 问题目标 | 使用方法 |
|----------|----------|
| 分类级别定价 | 模拟退火优化加成率 |
| 单品组合选择 | 遗传算法优化利润占比 |
| 精细补货建议 | 混合整数规划模型（MIQP） |
| 成本利润约束建模 | 使用 `cvxpy` 表达约束与目标函数 |

---

## 📊 模型关键结果展示

### 🔮 Prophet 预测示例

<img src="figures/prophet_forecast_example.png" width="600"/>

- 蓝线为真实销量，黑线为模型预测；
- 可观察到明显的节假日跳跃及周波动。

### 🧠 优化策略示例表格

| 单品名称 | 成本价 | 建议售价 | 预测销量 | 利润贡献 |
|----------|--------|----------|----------|-----------|
| 西兰花   | 4.2 元 | 6.8 元   | 98 kg    | 254.8 元   |
| 胡萝卜   | 2.3 元 | 3.6 元   | 120 kg   | 156 元     |

> 通过模拟退火模型迭代优化，结合销量预测，实现最大化收益策略。

---

## 🗂️ 项目结构说明

| 目录 / 文件       | 描述 |
|------------------|------|
| `notebooks/`     | 所有分析与建模的 Jupyter Notebook 示例 |
| `src/`           | 核心函数封装模块（如建模、优化函数） |
| `data/`          | 原始数据与预处理后的数据集 |
| `figures/`       | 自动生成的可视化图像 |
| `reports/`       | 模型总结报告、可交付文档 |
| `requirements.txt` | 项目依赖包列表 |

---

## 🧱 模块与方法对照表

| 模块文件 | 功能 | 关键技术 |
|----------|------|-----------|
| `data_cleaning.py` | 数据清洗与合并 | 缺失值填充、异常剔除 |
| `eda_analysis.py`  | EDA 可视化分析 | 热力图、堆叠柱状图 |
| `arima_model.py`   | ARIMA 模型预测 | statsmodels |
| `prophet_model.py` | 需求预测建模 | fbprophet |
| `optimizer.py`     | 价格策略优化 | 模拟退火、遗传算法 |
| `pricing_miqp.py`  | 补货规划优化 | 混合整数二次规划 |
| `plotting.py`      | 图像绘制模块 | matplotlib / seaborn |

---

## 🧬 项目优势与创新点

- ✅ **多源数据融合建模**：融合价格、销量、分类信息，实现完整建模闭环；
- ✅ **可解释性强的预测模型**：ARIMA + Prophet 双模结合，提高预测稳健性；
- ✅ **模块化优化策略输出**：单品 / 分类两层优化，灵活应对多种场景；
- ✅ **可视化支持丰富**：销售趋势、类别相关性、补货模拟等全链路图示；
- ✅ **易于迁移与迭代**：明确的目录结构与函数封装，方便未来部署与优化。

---

## 🔭 展望与未来工作

- 接入实时销售数据流，实现动态预测与智能补货；
- 加入天气、节假日等外部因子增强预测准确性；
- 引入库存约束与损耗机制，提升模型实用性；
- 构建可交互式仪表盘，面向运营人员部署。

---

## 📜 License

本项目遵循 MIT License，欢迎学术交流与非商业使用。

---
